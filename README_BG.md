# Full-Stack Starter Kit / AI Tools Directory

**Език:** [English](README.md) | [Български](#обзор-на-проекта)

> Официално описание на проекта (име, функции, инсталация, тестови потребители) е в **[README.md](README.md)** — на български и английски.

---

## Обзор на проекта

Професинална full-stack среда за разработка с **Laravel** бекенд и **Next.js** фронтенд. Включва ролево управление на достъпа (Owner, QA, Backend, Frontend и др.), двуфакторна автентикация (2FA), каталог с инструменти и одобрение на публикации, както и защита при навигация (back-button guard), за да не се показват кеширани чувствителни страници след изход.

---

## Технологичен стек

| Слой      | Технология                          | Порт  |
|-----------|-------------------------------------|-------|
| Бекенд    | **Laravel 12** + PHP 8.2 + Nginx    | 8201  |
| Фронтенд  | Next.js 18 + React + TypeScript    | 8200  |
| База данни| **MySQL 8.0**                       | 8203  |
| Кеш       | Redis 7                             | 8204  |
| Инструменти | Alpine контейнер                   | 8205  |

Приложението работи в **Docker** (Compose) с отделни услуги за бекенд, фронтенд, MySQL и Redis.

---

## Инструкции за инсталация

### Предварителни изисквания

- **Docker** и **Docker Compose**
- **Git Bash** (Windows) или bash (macOS/Linux) за изпълнение на скриптовете

### Docker команди

1. **Клониране и влизане в проекта:**
   ```bash
   cd full-stack-starter-kit
   ```

2. **Сглобяване и стартиране на всички услуги:**
   ```bash
   ./start.sh
   ```
   Или ръчно:
   ```bash
   docker compose build php_fpm
   docker compose up -d
   ```
   Изчакайте около 15–20 секунди да стартират услугите.

3. **Първоначална настройка на Laravel** (ако `backend/.env` няма `APP_KEY`):
   ```bash
   docker compose exec php_fpm php artisan key:generate --force
   docker compose exec php_fpm composer install --no-interaction
   docker compose exec php_fpm php artisan migrate --force
   docker compose exec php_fpm php artisan db:seed --force
   ```

4. **Достъп до приложението:**
   - **Бекенд (Laravel):** http://localhost:8201 — вход, табло, инструменти, админ
   - **Фронтенд (Next.js):** http://localhost:8200
   - **API статус:** http://localhost:8201/api/status

5. **Спиране на услугите:**
   ```bash
   docker compose down
   ```

### Тестов потребител (след seed)

- **Имейл:** `kiril@admin.local`
- **Парола:** `password123`
- **Роля:** Owner (админ). Използвайте за тестване на админ и потребители.

При проблем с входа изпълнете:
```bash
docker compose exec php_fpm php artisan migrate:fresh --seed
```

---

## Ролева система

Потребителите имат **професионална роля** (`users.role`) и **админ флаг** (`users.is_admin`). Достъпът се контролира чрез middleware.

### Потребителски роли

| Роля              | Описание               | Достъп |
|-------------------|------------------------|--------|
| **Owner**         | Пълен бизнес контрол   | Админ табло, CRUD потребители, одобрение инструменти |
| **Backend**       | Backend разработчик   | Каталог инструменти, собствени инструменти, профил |
| **Frontend**      | Frontend разработчик  | Също като Backend |
| **QA**            | Осигуряване на качество| Също като Backend |
| **Designer**      | Дизайн                 | Също като Backend |
| **Project manager** | PM                   | Също като Backend |

- **Админ** (`is_admin = true`): Достъп до `/admin` (табло, превключване статус на инструменти, одобрение/отхвърляне).
- **Owner** (`role = 'owner'`): Всичко като админ **плюс** CRUD на потребители (създаване, редакция, активиране/деактивиране, изтриване). Само собствениците могат да управляват потребители.

### Middleware

- `auth`, `verified`, `2fa` — задължителни за табло и основни маршрути.
- `admin` — изисква `is_admin`.
- `owner` — изисква `role === 'owner'` за маршрутите за управление на потребители.
- `disable.back.cache` — no-cache заглавия за чувствителни страници (вижте Сигурност).

---

## Функции за сигурност

### Двуфакторна автентикация (2FA)

- След вход с имейл/парола потребителят се пренасочва към **страница за 2FA верификация** и трябва да въведе **6-цифрен код** (напр. изпратен по имейл).
- Кодът е **еднократен** и има **15-минутна валидност**. След верификация кодът се изчиства; при изход също се изчиства, за да се генерира нов при следващ вход.
- Middleware гарантира, че таблото и приложението са достъпни само след завършена 2FA; верифицираните потребители не могат да използват бутона Назад за повторен достъп до страницата за верификация.

### Навигационна защита (back-button guard)

- **Сървърна страна:** Middleware `disable.back.cache` добавя no-cache заглавия (`Cache-Control`, `Pragma`, `Expires`) за auth, 2FA, табло, профил и админ маршрути, така че браузърът **не** подава кеширан HTML при натискане на Назад.
- **Клиентска страна:** За автентикирани потребители натискането на **Назад** отваря модал с потвърждение: „Искате ли да излезете от профила си?“ — **ДА** изпраща изход, **НЕ** оставя потребителя на страницата. Реализирано е с `history.pushState` / `popstate` и custom event, за да не се навигира към кеширано чувствително съдържание.

Заедно 2FA и навигационната защита намаляват риска от показване на чувствителни данни от кеш или при случайно натискане на Назад след изход.

---

## Добавяне на нови инструменти

- **Чрез интерфейса:** Вход → **Инструменти** → **Добави инструмент** (или `/tools/create`). Попълнете формата и изпратете; инструментът се създава със статус *pending* и може да бъде одобрен от админ.
- **API:** `GET /api/tools` — списък с инструменти; `GET /api/user` — текущ потребител (напр. за „Препоръчано за вашата роля“). Използвайте session credentials при извикване от фронтенда.

За повече детайли вижте пълните секции в README за инструменти, скриптове и отстраняване на грешки, както и `AI_DOCUMENTATION.md` и `AI_AGENTS.md` за AI-асистирана разработка и настройка на агенти.

---

## AI Агенти и разработка

### Как промптовете са използвани за изграждане на логиката

Проектът е разработен в сътрудничество с AI (Cursor, Copilot и др.). Ключовите области, при които са използвани **промпти** за дефиниране и реализация на логиката:

1. **Структура и Docker** — Описание на стека (Laravel 12, Docker, MySQL), портове и връзки между услуги; AI генерира и адаптира `docker-compose.yml` и скриптовете за стартиране.

2. **Автентикация и 2FA** — Промпт: „След логин генерирай 6-цифрен код, изпрати по имейл, пренасочи към verify-2fa; само след верификация достъп до табло; кодът е еднократен и изтича след 15 мин.“ От това са извлечени контролери, middleware и нотификации.

3. **Навигационна защита (back-button guard)** — Промпт: „При Back не трябва да се показва кеширана чувствителна страница; добави no-cache middleware и при Back за логнат потребител покажи модал ‚Искате ли да излезете?‘ и само при ДА изход.“ Реализирано с `DisableBackCache` middleware и Alpine.js модал с `pushState`/`popstate`.

4. **Ролева система** — Промпти за ролите (Owner, QA, Backend, Frontend и др.), кой какво може да прави, и за middleware (`admin`, `owner`). AI помага за дефиницията на `User::ALLOWED_ROLES`, маршрути и проверки.

5. **Правила за агента** — Промпти като „Винаги използвай Git Bash за команди“ и „Преди да кажеш ‚поправено е‘, провери с команда или тест“ са фиксирани като Cursor rules (`.cursor/rules/*.mdc`), за да се гарантира консистентно поведение на AI при разработка.

За **първоначални промпти за стартиране на development агент** и пълна документация за AI агенти вижте файла **`AI_AGENTS.md`**.
